
How I built a Honeypot VM, using Azure Sentinel to Track Malicious RDP Connections 
-------

Lately, I’ve been diving into Azure Sentinel and learning how to use it to strengthen cybersecurity defenses. One project that allowed me to apply my skills in log analysis and cloud security was setting up a honeypot using an Azure Virtual Machine with an exposed RDP port to see who would try to break in. The process involved a combination of configuring Azure Sentinel, setting up a Log Analytics Workspace, and using Kusto Query Language (KQL) to dig into the logs. Here's how I got it all working.

Why a Honeypot?
--------------
Honeypots are interesting because they attract malicious activity in a controlled, deceptive way, allowing you to observe and analyze real attacks. Remote Desktop Protocol (RDP) is a very important port that allows people to have remote access to your computer over the internet, so for this project, I wanted to track potential brute-force RDP attacks from high-risk regions like China and Russia. The goal was to log these attempts and automate alerts using Azure Sentinel for real-time monitoring. 

Setting Up the Azure Virtual Machine 
-----------------
First things first, I created a virtual machine in Azure. I opted for Windows Server because I wanted to target RDP, which is pretty common in real-world attacks. After setting it up, I made sure to open Port 3389 (RDP) in the Networking section. This is risky in the real world, but perfect for this project since it exposes the VM to potential attackers. Port 3389 is essentially a signal flare to every bot in the universe that dinner is ready.

![0e0e12df85f9105ecb228122ebfb6795](https://github.com/user-attachments/assets/d682efeb-c060-4a24-8847-d4a37ee48d9d)


Integrating Log Analytics
---------------
Next, I had to make sure all the incoming RDP attempts would be logged and sent to a central platform. I created a Log Analytics Workspace in Azure, which serves as the backbone for logging and analyzing the data after the Windows VM logs its data as it usually does. Then, I added a data connector to the VM to push the logs to the workspace. This is where all the connection data from incoming RDP attempts would end up for analysis. We then go to More content at Content Hub and install the Windows Security Events into our Sentinel’s data connector.
![982829816efaf33088d18d5694e48b83](https://github.com/user-attachments/assets/26dd38ec-7724-47f7-9df3-3e4257b15377)


Windows Security Events via AMA 
-----------
Windows Security Events via AMA (Azure Monitor Agent) refers to the process of collecting security event logs from Windows machines (such as virtual machines) using the AMA. AMA is the modern agent used by Azure to collect monitoring data from machines, replacing the older legacy Log Analytics agent.

We want to click on that data connector and click “open connector page” and create a data collection rule called “WindowsEventsToSentinel”. We will then click resources and select our VM. Then, we want to select all security events. After that data collection rule is created then we will soon see logs being collected and ingested into our Microsoft Sentinel.

Creating Rules 
-------
Windows Security Events are logs generated by the Windows Security system. These include important security related events like login attempts, account changes, privilege use, and access control changes. Examples of these event types include: 

Event ID 4624: Successful login 

Event ID 4625: Failed login 

Event ID 4672: Special privileges assigned to a new logon


You can make rules based on various parameters such as ID’s that match certain conditions but we will start off by creating a SecurityEvent rule that detects any activity that is successful, BUT, the account can’t be from the system itself. Therefore, alerting us when any incoming successful RDP connections occur.


![a503efd8f81282ec0b23282f68970605](https://github.com/user-attachments/assets/83bee0ef-76b1-4cb8-a580-835515d1c8b9)


We then want to go to “New Alert Rule” and create a sentinel rule called “Sucessful Local Sign Ins”, describing the rule we just created. You can go down further into the settings and establish Alert thresholds, defining how many events it would require for an alert to go off, as well as Query Scheduling which would run our query every X minutes, either automatically or at specific times. 

Lastly, we want to make sure Microsoft Sentinel alerts can be grouped into an incident that can be looked into, so you want to enable “Create incidents from alerts triggered by the analytics rule”. 

![5a7487e6fff69565567c257841b34914](https://github.com/user-attachments/assets/dd9820c9-6591-4928-8cbf-4ccd9ca46bf8)


Testing 
-------
Now that we have the rules created, and the data connectors established between the VM and the Log Analytics workspace, our honeypot VM with an exposed RDP port is ready to be tested. I went on to sign in to the VM via RDP and lo and behold, an alert appeared on our Microsoft Sentinel Incidents dashboard.

![620eee01de7b33f80a1ba8b2972b6856](https://github.com/user-attachments/assets/3a8bb1dc-f242-47cc-ada4-5838a4a957ae)



Final Thoughts 
-------
Building this project was a great way to strengthen my Azure security skills and get some practical experience with real-world attacks. If you’re looking to build out your cybersecurity toolkit, I’d highly recommend trying something similar. It’s a great way to understand how attackers operate and how tools like Azure Sentinel can help you stay one step ahead. I’m already thinking about my next project, maybe expanding the honeypot with different types of services or logging more advanced attack methods. Well see…
